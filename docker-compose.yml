services:
  pp2host:
    image: mariapori/pp2docker:latest
    container_name: pp2host
    ports:
      - "4500-4501:4500-4501"
    volumes:
      - pp2_static:/etc/pp2host/static
    restart: unless-stopped

  pp2detector:
    build: .
    container_name: pp2detector
    volumes:
      - pp2_static:/etc/pp2host/static:ro  # Read-only access to logs
      - ./data:/app/data  # Database and local logs
      - ./models:/app/models  # ML models
      - /var/run/docker.sock:/var/run/docker.sock  # For dynamic password discovery
    environment:
      - DISCORD_WEBHOOK_URL=${DISCORD_WEBHOOK_URL}
      - DISCORD_BOT_TOKEN=${DISCORD_BOT_TOKEN}
    extra_hosts:
      - "host.docker.internal:host-gateway"
    restart: unless-stopped

volumes:
  pp2_static:
